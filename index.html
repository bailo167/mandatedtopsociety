<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mandated Top Society</title>

<style>
/* ---------- CSS VARIABLES & RESET ---------- */
:root{
  --bg:#f7f7f7;
  --text:#222;
  --accent:#5EC3FF;
  --card:#fff;
}
body.dark{
  --bg:#1A1A1A;
  --text:#e0e0e0;
  --accent:#4FA4D9;
  --card:#292929;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.4em;min-height:100vh;padding-top:64px}

/* ---------- HEADER ---------- */
header{position:fixed;top:0;left:0;width:100%;height:64px;background:var(--bg);display:flex;align-items:center;justify-content:space-between;padding:0 1rem;box-shadow:0 2px 4px rgba(0,0,0,.1);z-index:1000}
#menuBtn{font-size:1.8rem;background:none;border:none;cursor:pointer;color:var(--text)}
header .banner{height:40px;max-width:50vw;object-fit:contain}
#modeToggle{background:none;border:2px solid var(--accent);border-radius:4px;padding:4px 8px;cursor:pointer;color:var(--accent);font-size:.9rem;white-space:nowrap}

/* ---------- SIDEBAR ---------- */
#sidebar{position:fixed;top:0;left:0;height:100%;width:260px;background:var(--card);padding:80px 1.2rem 1rem;transform:translateX(-100%);transition:transform .3s ease;z-index:1200}
#sidebar.open{transform:translateX(0)}
#sidebar a{display:block;margin:1rem 0;color:var(--text);text-decoration:none;font-size:1.05rem}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .3s ease;z-index:1100}
#overlay.show{opacity:1;pointer-events:auto}

/* ---------- SECTIONS ---------- */
section{padding:3rem 1rem;max-width:1200px;margin:auto}
h1,h2{margin-bottom:1.2rem;text-align:center}
h1{font-size:2rem}
h2{font-size:1.6rem}

#productsGrid,#instaGrid{display:grid;gap:1rem}
#productsGrid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
#productsGrid img,#instaGrid img,#instaGrid video{width:100%;height:auto;border-radius:6px;background:#ccc}

button.primary{display:inline-block;background:var(--accent);color:#fff;border:none;border-radius:4px;padding:.75rem 1.2rem;font-size:1rem;cursor:pointer;margin:1.5rem auto;transition:opacity .2s}
button.primary:hover,button.primary:focus{opacity:.85}

/* ---------- RADIO ---------- */
#radioBar{position:fixed;bottom:0;left:0;width:100%;background:var(--card);box-shadow:0 -2px 4px rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;gap:.75rem;padding:.5rem 1rem;z-index:1000}
#radioBar button{background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--text)}
#trackLabel{min-width:140px;text-align:center;font-size:.9rem}
#vol{width:100px}

/* ---------- FLOATING HATS ---------- */
@keyframes floatHat{
  from{transform:translate(110vw,var(--y)) rotate(var(--rot))}
  to{transform:translate(-110vw,var(--yEnd)) rotate(calc(var(--rot)*-1))}
}
.floating-hat{position:fixed;top:0;left:0;pointer-events:none;width:80px;animation:floatHat linear var(--dur) forwards}

/* ---------- ACCESSIBILITY STATES ---------- */
a:focus,button:focus{outline:2px dashed var(--accent);outline-offset:2px}
</style>
</head>
<body>

<!-- ---------- HEADER ---------- -->
<header>
  <button id="menuBtn" aria-label="Open menu">☰</button>
  <img src="/images/banner.jpg" alt="Mandated Top Society banner" class="banner">
  <button id="modeToggle">Hungover Mode</button>
</header>

<!-- ---------- SIDEBAR ---------- -->
<nav id="sidebar" aria-label="Sidebar navigation">
  <a href="https://mandatedtopsociety.com">Home</a>
  <a href="https://mandatedtopsociety.com/products">Products</a>
  <a href="https://mandatedtopsociety.com/tryon">Try On</a>
  <a href="https://mandatedtopsociety.com/radio">MTS Radio</a>
  <a href="https://instagram.com/mandatedtopsociety" target="_blank" rel="noopener">Instagram</a>
</nav>
<div id="overlay"></div>

<!-- ---------- MAIN CONTENT ---------- -->
<main>
  <!-- Hero -->
  <section id="hero">
    <h1>Welcome to the Mandated Top Society!</h1>
    <p style="text-align:center;margin-bottom:1.5rem;">We advocate for government‑mandated top.</p>
    <div style="text-align:center">
      <button class="primary" onclick="location.href='https://mandatedtopsociety.com/tryon'">Try On Our Hats</button>
    </div>
  </section>

  <!-- Products -->
  <section id="products">
    <h2>Products</h2>
    <div id="productsGrid">
      <img src="/images/white.png" alt="White hat">
      <img src="/images/pink.png" alt="Pink hat">
      <img src="/images/blue.png" alt="Blue hat">
      <img src="/images/green.png" alt="Green hat">
      <img src="/images/red.png" alt="Red hat">
    </div>
    <div style="text-align:center">
      <button class="primary" onclick="location.href='https://mandatedtopsociety.com/tryon'">Try On Our Hats</button>
    </div>
  </section>

  <!-- Instagram -->
  <section id="instagram">
    <h2>Our Instagram</h2>
    <div id="instaGrid" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr))"></div>
  </section>
</main>

<!-- ---------- RADIO BAR ---------- -->
<div id="radioBar">
  <button id="prevBtn" aria-label="Previous track">◀︎</button>
  <button id="playPauseBtn" aria-label="Play/Pause">▷</button>
  <button id="nextBtn" aria-label="Next track">▶︎</button>
  <span id="trackLabel">&nbsp;</span>
  <input id="vol" type="range" min="0" max="1" step="0.01" value="1" aria-label="Volume">
  <audio id="audio" preload="none"></audio>
</div>

<script>
(function(){
  /* ---------- THEME TOGGLE ---------- */
  const body=document.body,modeBtn=document.getElementById('modeToggle');
  const applyTheme=dark=>{body.classList.toggle('dark',dark);modeBtn.textContent='Hungover Mode';localStorage.setItem('mtsTheme',dark?'dark':'light');}
  applyTheme(localStorage.getItem('mtsTheme')==='dark');
  modeBtn.addEventListener('click',()=>applyTheme(!body.classList.contains('dark')));

  /* ---------- SIDEBAR ---------- */
  const sidebar=document.getElementById('sidebar'),overlay=document.getElementById('overlay');
  const openNav=()=>{sidebar.classList.add('open');overlay.classList.add('show');}
  const closeNav=()=>{sidebar.classList.remove('open');overlay.classList.remove('show');}
  document.getElementById('menuBtn').addEventListener('click',openNav);
  overlay.addEventListener('click',closeNav);
  sidebar.addEventListener('click',e=>e.target.tagName==='A'&&closeNav());

  /* ---------- INSTAGRAM FETCH ---------- */
  fetch('/api/insta').then(r=>r.json()).then(({data})=>{
    const grid=document.getElementById('instaGrid');
    data.slice(0,12).forEach(p=>{
      const a=document.createElement('a');a.href=p.permalink;a.target='_blank';a.rel='noopener';
      if(p.is_video){
        const v=document.createElement('video');v.src=p.url;v.poster=p.thumb;v.muted=true;v.playsInline=true;v.loop=true;
        v.addEventListener('mouseenter',()=>v.play());v.addEventListener('mouseleave',()=>v.pause());
        a.appendChild(v);
      }else{
        const img=document.createElement('img');img.src=p.thumb;img.alt=p.caption||'Instagram image';
        a.appendChild(img);
      }
      grid.appendChild(a);
    });
  }).catch(()=>{document.getElementById('instaGrid').textContent='Unable to load feed.'});

  /* ---------- RADIO PLAYER ---------- */
  const playlist=[
    {src:'/music/track1.mp3',artist:'Artist1',title:'Song1'},
    {src:'/music/track2.mp3',artist:'Artist2',title:'Song2'},
    {src:'/music/track3.mp3',artist:'Artist3',title:'Song3'}
  ];
  let index=Math.floor(Math.random()*playlist.length),started=false;
  const audio=document.getElementById('audio'),label=document.getElementById('trackLabel');
  const load=()=>{const t=playlist[index];audio.src=t.src;label.textContent=`${t.artist} – ${t.title}`;}
  load();
  const playPauseBtn=document.getElementById('playPauseBtn');
  const play=()=>{audio.play();playPauseBtn.textContent='❚❚';}
  const pause=()=>{audio.pause();playPauseBtn.textContent='▷';}
  playPauseBtn.addEventListener('click',()=>{started? (audio.paused?play():pause()) : (started=true,play());});
  document.getElementById('prevBtn').addEventListener('click',()=>{index=(index-1+playlist.length)%playlist.length;load();play();});
  document.getElementById('nextBtn').addEventListener('click',()=>{index=(index+1)%playlist.length;load();play();});
  audio.addEventListener('ended',()=>{index=(index+1)%playlist.length;load();play();});
  document.getElementById('vol').addEventListener('input',e=>audio.volume=e.target.value);

  /* ---------- FLOATING HATS ---------- */
  const hatImgs=['white','pink','blue','green','red'];
  const createHat=()=>{
    const img=document.createElement('img');
    img.src=`/images/${hatImgs[Math.floor(Math.random()*hatImgs.length)]}.png`;
    img.className='floating-hat';
    const y=Math.random()*60-10, yEnd=y+Math.random()*20-10, rot=(Math.random()>.5?1:-1)*(30+Math.random()*60),
          dur=15+Math.random()*10;
    img.style.setProperty('--y',`${y}vh`);
    img.style.setProperty('--yEnd',`${yEnd}vh`);
    img.style.setProperty('--rot',`${rot}deg`);
    img.style.setProperty('--dur',`${dur}s`);
    document.body.appendChild(img);
    img.addEventListener('animationend',()=>img.remove());
  };
  const hatLoop=()=>{createHat();setTimeout(hatLoop,(30+Math.random()*15)*1000);}
  hatLoop();
})();
</script>

</body>
</html>