<!DOCTYPE html>
<html lang="en-AU" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mandated Top Society</title>
<style>
/* ---------- CSS Variables ---------- */
:root{
	--bg:#fafafa;
	--text:#1f1f1f;
	--accent:#5EC3FF;
	--bg-alt:#ffffff;
}
html[data-theme="dark"]{
	--bg:#1A1A1A;
	--text:#e5e5e5;
	--accent:#4FA4D9;
	--bg-alt:#2b2b2b;
}

/* ---------- Base ---------- */
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.45}
img,video{max-width:100%;display:block}

/* ---------- Header ---------- */
header{
	position:fixed;top:0;left:0;width:100%;height:64px;padding:0 1rem;
	background:var(--bg-alt);display:flex;align-items:center;justify-content:space-between;
	border-bottom:1px solid rgba(0,0,0,.05);z-index:1000
}
#burger{font-size:1.75rem;border:none;background:none;cursor:pointer;line-height:1}
#banner{height:48px;width:auto;object-fit:contain}
#modeToggle{border:1px solid var(--accent);background:none;padding:.4rem .8rem;border-radius:4px;font:inherit;color:var(--text);cursor:pointer}

/* ---------- Sidebar ---------- */
#sidebar{
	position:fixed;top:0;left:0;height:100%;width:250px;padding:80px 1.25rem 1.5rem; /* leave room for header */
	background:var(--bg-alt);transform:translateX(-100%);transition:.3s transform ease;z-index:1100
}
#sidebar.open{transform:none}
#sidebar a{display:block;margin-bottom:1rem;text-decoration:none;color:var(--text);font-size:1.1rem}
#overlay{
	position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.2);
	backdrop-filter:blur(1px);display:none;z-index:1050
}
#overlay.active{display:block}

/* ---------- Main ---------- */
main{padding:96px 1rem 120px;max-width:1200px;margin:auto}
h1{
	font-size:2.3rem;font-weight:700;line-height:1.35;margin-block:0.35em 0.9em;text-align:center
}
section{margin-top:3.5rem}
section h2{font-size:1.8rem;margin-bottom:1.2rem;text-align:center}
#spiel{font-size:1.1rem;text-align:center;max-width:650px;margin:.8rem auto 2rem}
.button{
	display:inline-block;background:var(--accent);color:#fff;text-decoration:none;padding:.65rem 1.4rem;
	border-radius:4px;font-weight:600;transition:.2s opacity
}
.button:hover,.button:focus{opacity:.85}

/* ---------- Grids ---------- */
.grid{
	display:grid;gap:1rem
}
#products .grid{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
#instagram .grid{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}
#instagram .grid a{position:relative;isolation:isolate}
#instagram video{object-fit:cover;height:100%}

/* ---------- Hat Animation ---------- */
@keyframes drift{
	from{transform:translateX(0) translateY(0) rotate(0deg)}
	to{transform:translateX(-110vw) translateY(20px) rotate(var(--rot))}
}
.floater{
	position:fixed;top:calc(10% + var(--randY));right:-120px;width:100px;pointer-events:none;
	animation:drift var(--dur) linear forwards;
}

/* ---------- MTS Radio ---------- */
#audioBar{
	position:fixed;bottom:0;left:0;width:100%;padding:.5rem 1rem;background:var(--bg-alt);
	display:flex;align-items:center;justify-content:center;gap:1rem;border-top:1px solid rgba(0,0,0,.05)
}
#audioBar button,#audioBar input{font:inherit}
#audioBar button{
	border:none;background:none;cursor:pointer;font-size:1.3rem;color:var(--text)
}
#trackLabel{min-width:140px;font-size:.9rem;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* ---------- Accessibility ---------- */
a:focus-visible,button:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
@media (hover:hover){
	#sidebar a:hover{text-decoration:underline}
}
</style>
</head>
<body>
<header>
	<button id="burger" aria-label="Menu">☰</button>
	<img id="banner" src="/images/banner.jpg" alt="Mandated Top Society">
	<button id="modeToggle">Hungover Mode</button>
</header>

<nav id="sidebar" aria-label="Site">
	<a href="https://mandatedtopsociety.com">Home</a>
	<a href="https://mandatedtopsociety.com/products">Products</a>
	<a href="https://mandatedtopsociety.com/tryon">Try On</a>
	<a href="https://mandatedtopsociety.com/radio">MTS Radio</a>
	<a href="https://instagram.com/mandatedtopsociety" target="_blank" rel="noopener">Instagram</a>
</nav>
<div id="overlay"></div>

<main>
	<!-- Hero -->
	<section id="hero">
		<h1>Welcome to the <br>Mandated Top Society!</h1>
		<p id="spiel">We advocate for government‑mandated top.</p>
		<p style="text-align:center"><a class="button" href="https://mandatedtopsociety.com/tryon">Try On Our Hats</a></p>
	</section>

	<!-- Products -->
	<section id="products">
		<h2>Products</h2>
		<div class="grid">
			<img src="/images/white.png" alt="White hat">
			<img src="/images/pink.png"  alt="Pink hat">
			<img src="/images/blue.png"  alt="Blue hat">
			<img src="/images/green.png" alt="Green hat">
			<img src="/images/red.png"   alt="Red hat">
		</div>
		<p style="text-align:center;margin-top:2rem"><a class="button" href="https://mandatedtopsociety.com/tryon">Try On Our Hats</a></p>
	</section>

	<!-- Instagram -->
	<section id="instagram">
		<h2>Our Instagram</h2>
		<div class="grid" id="instaGrid"></div>
		<p id="instaFallback" style="text-align:center;display:none">Instagram feed unavailable.</p>
	</section>
</main>

<!-- MTS Radio -->
<div id="audioBar">
	<button id="prev" aria-label="Previous track">◀︎</button>
	<button id="playPause" aria-label="Play" data-state="paused">▷</button>
	<button id="next" aria-label="Next track">▶︎</button>
	<span id="trackLabel">MTS Radio</span>
	<input type="range" id="volume" min="0" max="1" step="0.05" value="1" aria-label="Volume">
</div>
<audio id="audio" preload="none"></audio>

<script>
(()=>{'use strict';

/* ---------- Helpers ---------- */
const $=s=>document.querySelector(s);
const $$=s=>document.querySelectorAll(s);

/* ---------- Theme Toggle ---------- */
const modeBtn=$('#modeToggle');
const root=document.documentElement;
const storedTheme=localStorage.getItem('mts-theme');
if(storedTheme){root.dataset.theme=storedTheme}
modeBtn.addEventListener('click',()=>{
	const newTheme=root.dataset.theme==='dark'?'light':'dark';
	root.dataset.theme=newTheme;
	localStorage.setItem('mts-theme',newTheme);
});

/* ---------- Sidebar ---------- */
const sidebar=$('#sidebar'),overlay=$('#overlay'),burger=$('#burger');
function openNav(){sidebar.classList.add('open');overlay.classList.add('active')}
function closeNav(){sidebar.classList.remove('open');overlay.classList.remove('active')}
burger.addEventListener('click',openNav);
overlay.addEventListener('click',closeNav);

/* ---------- Instagram Fetch ---------- */
fetch('/api/insta').then(r=>r.json()).then(({data})=>{
	if(!Array.isArray(data)||!data.length)throw 0;
	const grid=$('#instaGrid');
	data.slice(0,12).forEach(item=>{
		const a=document.createElement('a');
		a.href=item.permalink;a.target='_blank';a.rel='noopener';
		if(item.is_video){
			const v=document.createElement('video');
			v.src=item.thumb||item.url;v.muted=true;v.playsInline=true;v.autoplay=false;
			a.appendChild(v);
		}else{
			const img=document.createElement('img');
			img.src=item.thumb||item.url;img.alt=item.caption||'Instagram image';
			a.appendChild(img);
		}
		grid.appendChild(a);
	});
}).catch(()=>$('#instaFallback').style.display='block');

/* ---------- Audio Player ---------- */
const playlist=[
	{src:'/music/track1.mp3',artist:'',title:'Track 1'},
	{src:'/music/track2.mp3',artist:'',title:'Track 2'},
	{src:'/music/track3.mp3',artist:'',title:'Track 3'}
];
let current=Math.floor(Math.random()*playlist.length);
const audio=$('#audio'),playBtn=$('#playPause'),prevBtn=$('#prev'),nextBtn=$('#next'),label=$('#trackLabel'),vol=$('#volume');
function load(i){
	current=(i+playlist.length)%playlist.length;
	const track=playlist[current];
	audio.src=track.src;
	label.textContent=`${track.artist?track.artist+' – ':''}${track.title}`;
}
function play(){audio.play();playBtn.textContent='❚❚';playBtn.dataset.state='playing'}
function pause(){audio.pause();playBtn.textContent='▷';playBtn.dataset.state='paused'}
playBtn.addEventListener('click',()=>playBtn.dataset.state==='paused'?play():pause());
prevBtn.addEventListener('click',()=>{load(current-1);play()});
nextBtn.addEventListener('click',()=>{load(current+1);play()});
audio.addEventListener('ended',()=>{load(current+1);play()});
vol.addEventListener('input',e=>audio.volume=e.target.value);
load(current);

/* ---------- Floating Hats ---------- */
const hatImgs=['white','pink','blue','green','red'].map(c=>`/images/${c}.png`);
function spawnHat(){
	const img=document.createElement('img');
	img.src=hatImgs[Math.floor(Math.random()*hatImgs.length)];
	img.className='floater';
	img.style.setProperty('--rot',`${Math.random()>0.5?'' : '-'}${30+Math.random()*60}deg`);
	img.style.setProperty('--dur',`${10+Math.random()*10}s`);
	img.style.setProperty('--randY',`${Math.random()*60}vh`);
	document.body.appendChild(img);
	img.addEventListener('animationend',()=>img.remove());
}
setInterval(spawnHat,30000+Math.random()*15000);
})();
</script>
</body>
</html>