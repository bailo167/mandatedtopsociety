<!DOCTYPE html>
<html lang="en-AU" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AR Try‑On – Mandated Top Society</title>
<link rel="icon" href="/images/mainlogo.png" type="image/png">

<!-- MindAR Face (face‑tracking) + THREE + GLTF loader -->
<script type="module">
import {MindARThree} from "https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-face-three.prod.js";
import * as THREE        from "https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.module.js";
import {GLTFLoader}      from "https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/loaders/GLTFLoader.js";

window.startHatAR = async () => {
  document.getElementById("startBtn").remove();
  const container = document.getElementById("ar");
  container.style.display = "block";

  /* 1 – boot MindAR */
  const mindar = new MindARThree({
    container,
    filterMinCF:0.1,
    filterBeta:0.02
  });
  const {renderer, scene, camera} = mindar;

  /* 2 – lighting */
  scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));

  /* 3 – load hat GLB */
  const loader = new GLTFLoader();
  let hat = (await loader.loadAsync("/models/whitebuckethat.glb")).scene;
  hat.position.set(0,0.15,0);      /* tweak height above face */
  hat.scale.set(1,1,1);

  /* 4 – anchor to forehead (index 168) */
  const anchor = mindar.addAnchor(168);
  anchor.group.add(hat);

  /* 5 – start camera */
  await mindar.start();
  renderer.setAnimationLoop(() => renderer.render(scene, camera));

  /* optional colour swap buttons */
  document.querySelectorAll(".swatch").forEach(btn=>{
    btn.onclick = async () => {
      const g = (await loader.loadAsync(`/models/${btn.dataset.color}buckethat.glb`)).scene;
      g.position.copy(hat.position);
      g.scale.copy(hat.scale);
      anchor.group.remove(hat);
      anchor.group.add(g);
      hat = g;
    };
  });
};
</script>

<style>
:root{--bg:#fafafa;--text:#1f1f1f;--accent:#5EC3FF;}
body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--text);text-align:center}
button{font:inherit;cursor:pointer}
#startBtn{margin:4rem auto;padding:.8rem 1.6rem;background:var(--accent);color:#fff;border:none;border-radius:6px;font-weight:600}
#ar{display:none;width:100%;max-width:640px;margin:1.5rem auto;border-radius:8px;overflow:hidden}
.swatch{width:32px;height:32px;border-radius:50%;border:1px solid #999;margin:.3rem;display:inline-block}
.swatch:focus-visible{outline:2px solid var(--accent)}
</style>
</head>
<body>

<h1 style="margin-top:1.2rem">Try On Our Bucket Hat</h1>

<button id="startBtn" onclick="startHatAR()">Start camera</button>

<div id="ar"></div>

<!-- colour selector (optional) -->
<div id="swatches" style="margin-top:.8rem">
  <div class="swatch" data-color="white" style="background:#ffffff"></div>
  <div class="swatch" data-color="pink"  style="background:#f7adc3"></div>
  <div class="swatch" data-color="blue"  style="background:#4aa4ff"></div>
  <div class="swatch" data-color="green" style="background:#3ac65a"></div>
</div>

<p style="margin-top:2rem">
  <a href="/products" style="color:var(--accent);text-decoration:none;font-weight:600">← Back to Products</a>
</p>

</body>
</html>
